.chat-toggle{
  position: fixed; bottom: 18px; right: 18px;
  width: 64px; height: 64px;
  border-radius: 18px;
  display:grid; place-items:center;
  font-size: 26px;
  color:#fff; border:1px solid rgba(255,255,255,.28);
  background: linear-gradient(180deg,#1e3a8a 0%, #0f2a5f 100%);
  box-shadow:
    0 10px 28px rgba(0,0,0,.30),
    inset 0 1px 0 rgba(255,255,255,.12);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  cursor:pointer;
  transition: transform .15s ease, box-shadow .2s ease, background .2s ease, filter .2s ease;
  z-index: 9999;
  isolation: isolate;
}

.chat-toggle::before{
  content:"";
  position:absolute; inset:-6px;
  border-radius:22px;
  background: radial-gradient(60% 60% at 50% 50%, rgba(59,130,246,.35), transparent 60%);
  opacity:.45;
  filter: blur(10px);
  transition: opacity .2s ease, transform .2s ease;
  z-index:-1;
}

.chat-toggle::after{
  content:"";
  position:absolute; inset:0;
  border-radius:18px;
  background: linear-gradient(140deg, rgba(255,255,255,.16), rgba(255,255,255,0) 40%);
  mix-blend-mode: screen;
  pointer-events:none;
}

.chat-toggle:hover{
  transform: translateY(-2px) scale(1.03);
  box-shadow:
    0 16px 36px rgba(30,58,138,.45),
    inset 0 1px 0 rgba(255,255,255,.16);
  filter: saturate(1.05);
}
.chat-toggle:hover::before{ opacity:.65; transform: scale(1.03); }
.chat-toggle:active{ transform: translateY(0) scale(.99); }

@keyframes chatPulse {
  0% { box-shadow: 0 0 0 0 rgba(59,130,246,.45); }
  70%{ box-shadow: 0 0 0 14px rgba(59,130,246,0); }
  100%{ box-shadow: 0 0 0 0 rgba(59,130,246,0); }
}
.chat-toggle:not([aria-expanded="true"]){
  animation: chatPulse 2.2s ease-out infinite;
}

.chat-toggle .badge{
  position:absolute; top:-4px; right:-4px;
  min-width:20px; height:20px; padding:0 6px;
  border-radius:999px; display:grid; place-items:center;
  background:#ef4444; color:#fff; font-weight:700; font-size:11px;
  box-shadow:0 6px 16px rgba(239,68,68,.4), 0 0 0 2px #fff;
}

@media (prefers-reduced-motion: reduce){
  .chat-toggle,
  .chat-toggle::before{ transition:none; }
  .chat-toggle{ animation:none; }
}

.chat-window{
  position: fixed; bottom: 16px; right: 16px;
  width: 360px;
  height: 48vh;
  max-height: 65vh;
  min-width: 280px;
  min-height: 300px;
  max-width: 90vw;
  display:flex; flex-direction:column;
  background:#fff; border-radius:14px; overflow:hidden;
  box-shadow:0 16px 40px rgba(0,0,0,.22);
  z-index: 9999;

  resize: both;
}

.chat-window::after{
  content: "";
  position: absolute; right: 6px; bottom: 6px;
  width: 12px; height: 12px;
  border-bottom: 2px solid #9aa6b2;
  border-right: 2px solid #9aa6b2;
  opacity: .55; pointer-events: none;
}

.chat-header{
  display:flex; align-items:center; justify-content:space-between;
  background:linear-gradient(90deg,#0b1220 0%, #13243f 100%); color:#e6edf7;
  padding:8px 10px;
  cursor: grab; user-select: none;
}
.chat-header.dragging{ cursor: grabbing; }

.brand{ display:flex; align-items:center; gap:8px; }
.brand .logo{ font-size:18px }
.brand .title{ font-weight:800; letter-spacing:.2px; font-size:14px; }
.brand .subtitle{ font-size:11px; opacity:.75; margin-left:6px; }

.chat-header-buttons{ display:flex; gap:6px; }
.icon-btn{
  background:transparent; border:0; color:#e5e7eb; cursor:pointer; font-size:16px;
  padding:6px; border-radius:8px; transition: background .12s, transform .12s;
}
.icon-btn:hover{ background:rgba(255,255,255,.1); transform: translateY(-1px); }

.messages{
  flex:1; min-height: 0;
  padding:8px; overflow:auto; background:#eef2f7;
  scroll-behavior:smooth;
}

.messages::-webkit-scrollbar{ width:8px; }
.messages::-webkit-scrollbar-thumb{
  background:#cbd5e1; border-radius:8px; border:2px solid #eef2f7;
}
.messages::-webkit-scrollbar-track{ background:#eef2f7; }

.msg{ display:flex; gap:6px; margin-bottom:8px; }
.msg.user{ flex-direction: row-reverse; }
.avatar{ width:24px; height:24px; display:grid; place-items:center; font-size:16px; }

.bubble{
  max-width: 85%;
  background:#e6eef8; color:#0f172a; border-radius:12px; padding:8px 10px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
}
.msg.user .bubble{ background:#1d4ed8; color:#fff; border-top-right-radius:4px; }
.msg.bot  .bubble{ background:#ffffff; color:#0f172a; border:1px solid #e5e7eb; border-top-left-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,.06); }

.meta{ display:flex; gap:8px; font-size:10px; opacity:.9; margin-bottom:2px; color:#475569; }
.msg.user .meta{ color:#e2e8f0; }
.content{ font-size:15px; line-height:1.4; word-wrap:break-word; }
.inline-image{ width:150px; height:100px; object-fit:cover; border-radius:8px; margin-top:6px; }

.typing .bubble{ padding:9px 12px; }
.dots i{
  width:6px; height:6px; display:inline-block; margin-right:4px;
  background:#9aa6b2; border-radius:50%; animation: blink 1.2s infinite ease-in-out;
}
.dots i:nth-child(2){ animation-delay:.15s }
.dots i:nth-child(3){ animation-delay:.3s }
@keyframes blink{ 0%,80%,100%{ opacity:.2 } 40%{ opacity:1 } }

.quick-replies{
  display:flex; gap:6px; flex-wrap:wrap; padding:6px 8px;
  border-top:1px solid #e2e8f0; background:#fff;
}
.quick-replies button{
  border:1px solid #cbd5e1; background:#ffffff; color:#0f172a;
  border-radius:9999px; padding:6px 10px; font-size:12px; font-weight:600; cursor:pointer;
  transition: background .12s, transform .12s, border-color .12s;
}
.quick-replies button:hover{ background:#f1f5f9; transform: translateY(-1px); border-color:#94a3b8; }

.input-area{ display:flex; gap:6px; border-top:1px solid #e2e8f0; padding:6px; background:#ffffff; }
.input-area textarea{
  flex:1; resize:none; border:0; outline:none; font-size:14px; line-height:1.35; max-height:140px;
  min-height:38px; padding:10px 12px; background:#ffffff; color:#0f172a;
}
.input-area textarea::placeholder{ color:#94a3b8; opacity:1; }
.input-area button{
  background:#1d4ed8; color:#fff; border:0; padding:0 12px; border-radius:10px; cursor:pointer; font-size:18px;
  transition: background .12s, transform .12s; min-width:44px; min-height:38px;
}
.input-area button:disabled{ opacity:.6; cursor:not-allowed; }
.input-area button:hover:not(:disabled){ background:#1b46c2; transform: translateY(-1px); }

::ng-deep .content .car-card{
  background:#fff; border:1px solid #e2e8f0; border-radius:12px; padding:8px; margin:6px 0;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
}
::ng-deep .content .car-card img.car-image{
  width:160px !important; height:110px !important; object-fit:cover; border-radius:8px; display:block; margin:8px 0 0;
}

@media (min-width: 1280px){
  .chat-window{
    width: 420px;
    height: 52vh;
    max-height: 68vh;
  }
  .bubble{ max-width: 88%; }
}

@media (max-width: 520px){
  .chat-window{
    left: 10px; right: 10px; bottom: 10px;
    width: auto;
    height: 74vh;
    max-height: 85vh;
    border-radius: 14px;
  }
  .chat-toggle{ right:12px; bottom:12px; width:56px; height:56px; font-size:24px; border-radius:16px; }
  .inline-image{ width:140px; height:96px; }
}
