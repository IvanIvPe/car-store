<div *ngIf="cartItems.length === 0" class="cart-empty" aria-live="polite">
  <mat-icon>shopping_bag</mat-icon>
  <h3>Your cart is empty</h3>
  <p>Add a car to reserve it.</p>
  <a mat-stroked-button color="primary" routerLink="/cars" class="empty-cta">
    <mat-icon>directions_car</mat-icon>
    Browse cars
  </a>
</div>


<mat-card *ngIf="cartItems.length > 0" class="cart-card">
  <div class="card-header">
    <h2>My Cart</h2>
  </div>
  <mat-divider></mat-divider>

  <div class="table-wrap">
    <table mat-table [dataSource]="cartItems" class="mat-elevation-z2 cart-table">

      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>Picture</th>
        <td mat-cell *matCellDef="let item">
          <img
            class="thumb"
            [src]="item.image || 'assets/images/placeholder-car.png'"
            (error)="onCarImageError($event)"
            [alt]="displayName(item)"
          />
        </td>
      </ng-container>

      <ng-container matColumnDef="model">
        <th mat-header-cell *matHeaderCellDef>Car</th>
        <td mat-cell *matCellDef="let item" class="model-cell">

          <div class="model">{{ displayName(item) }}</div>


          <div class="sub">
            <ng-container *ngIf="item.year">{{ item.year }}</ng-container>
            <ng-container *ngIf="item.year && (item.fuel || item.mileage != null)"> • </ng-container>
            <ng-container *ngIf="item.fuel">{{ item.fuel }}</ng-container>
            <ng-container *ngIf="(item.year || item.fuel) && item.mileage != null"> • </ng-container>
            <ng-container *ngIf="item.mileage != null">{{ item.mileage | number }} km</ng-container>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Price</th>
        <td mat-cell *matCellDef="let item" class="price-cell">
          {{ item.price | currency:'EUR':'symbol':'1.0-0' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Action</th>
        <td mat-cell *matCellDef="let item">
          <button mat-icon-button color="warn" (click)="removeItem(item.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <div class="summary-card">
    <h3>Order summary</h3>

    <div class="row">
      <span>Subtotal</span>
      <span>{{ subtotal | currency:'EUR':'symbol':'1.0-0' }}</span>
    </div>

    <div class="row" *ngIf="promoDiscount > 0">
      <span>Promo ({{ promoName }})</span>
      <span>-{{ (subtotal * promoDiscount) | currency:'EUR':'symbol':'1.0-0' }}</span>
    </div>

    <div class="row">
      <span>VAT (20%)</span>
      <span>{{ vat | currency:'EUR':'symbol':'1.0-0' }}</span>
    </div>

    <div class="row total">
      <span>Total</span>
      <span>{{ total | currency:'EUR':'symbol':'1.0-0' }}</span>
    </div>

    <mat-form-field appearance="fill" class="promo-field">
      <mat-label>Promo code</mat-label>
      <input matInput [(ngModel)]="promo" (keyup.enter)="applyPromo()">
    </mat-form-field>

    <div class="summary-actions">
      <button mat-stroked-button color="warn" (click)="clearCart()">Empty cart</button>
      <a mat-flat-button color="primary" routerLink="/checkout">Checkout</a>
    </div>
  </div>
</mat-card>
